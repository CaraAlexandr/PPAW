@startuml Password Generation Validation Flow

!theme plain
skinparam activity {
  BackgroundColor #LightBlue
  BorderColor #DarkBlue
  FontColor #Black
}

start

:User requests password generation;
note right
  POST /api/password/generate
  {
    "length": 25,
    "includeUpper": true,
    "includeLower": true,
    "includeDigits": true,
    "includeSymbols": true,
    "excludeAmbiguous": true,
    "noRepeats": false
  }
end note

:Load user from database;
:Get user's service plan;
:Load plan limits from database;

partition "Plan Validation" {
  if (Requested length > Plan limit?) then (yes)
    :Return 403 Forbidden;
    note right
      Error: "Password length (25) exceeds
      your plan's maximum (16).
      Upgrade to generate longer passwords."
    end note
    stop
  else (no)
    :Length check passed;
  endif

  if (excludeAmbiguous requested?) then (yes)
    if (Plan allows excludeAmbiguous?) then (yes)
      :Allow exclude ambiguous characters;
    else (no)
      :Ignore excludeAmbiguous flag;
      note right
        Plan doesn't support this feature.
        Generate without excluding ambiguous.
      end note
    endif
  else (no)
    :Standard generation;
  endif
}

partition "Password Generation" {
  :Build character set based on options;
  :Exclude ambiguous if enabled;
  :Check for minimum character requirements;
  
  if (Valid character set?) then (no)
    :Return 400 Bad Request;
    note right
      Error: "At least one character type
      must be included"
    end note
    stop
  else (yes)
    :Generate random password;
    :Apply noRepeats if requested;
    :Validate password meets all requirements;
  endif
}

:Encrypt password (if storing);
:Return generated password;
note right
  Response:
  {
    "password": "Xy9@mK#pL2$qW",
    "length": 16,
    "strength": "Strong"
  }
end note

stop

@enduml

